<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>æˆ‘çš„å·¥ä½œå°</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸš€</text></svg>">
<style>
    body {
        font-family: 'Roboto', Arial, sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #E3F2FD 0%, #ffffff 100%);
        background-size: cover;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        background-attachment: fixed;
        background-repeat: no-repeat;
    }

    /* --- å¯¼èˆªå›¾æ ‡åŒºåŸŸæ ·å¼ (åŠ¨æ€ç”Ÿæˆ) --- */
    .shortcut-icons-container {
        width: 800px;
        display: flex;
        justify-content: center;
        padding: 15px 0;
        margin-top: 40px;
        background-color: rgba(255,255,255,0.5);
        border-radius: 10px;
        backdrop-filter: blur(10px);
        position: relative; /* ä¸ºç¼–è¾‘æŒ‰é’®å®šä½ */
    }
    .shortcut-icons {
        display: flex;
        justify-content: flex-start; /* æ”¹ä¸ºå·¦å¯¹é½ï¼Œé…åˆæ¢è¡Œ */
        flex-wrap: wrap;
        gap: 30px; /* é—´è· */
        width: 100%;
        padding: 0 40px;
    }
    .icon-wrapper {
        position: relative;
        text-align: center;
        width: 100px; /* å›ºå®šå®½åº¦ç¡®ä¿å¯¹é½ */
    }
    .icon-box {
        width: 100px;
        height: 100px;
        background-color: #ffffff;
        border-radius: 15px;
        transition: all 0.3s;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        text-decoration: none;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .icon-box:hover {
        background-color: #E8F5FE;
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    /* å›¾ç‰‡æ ·å¼ï¼šæ”¯æŒ URL å›¾ç‰‡æˆ– Emoji æ–‡å­— */
    .icon-box img {
        width: 60px;
        height: 60px;
        object-fit: contain;
    }
    .icon-emoji {
        font-size: 50px;
    }
    .icon-label {
        font-size: 14px;
        margin-top: 8px;
        color: #333;
        font-weight: 500;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* --- ç¼–è¾‘æ¨¡å¼æ ·å¼ --- */
    #editToggleBtn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: transparent;
        border: 1px solid #ccc;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 12px;
        color: #666;
        opacity: 0.5;
        transition: opacity 0.3s;
    }
    #editToggleBtn:hover { opacity: 1; }
    
    .delete-btn {
        position: absolute;
        top: -8px;
        right: -8px;
        background: #ff4444;
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        text-align: center;
        line-height: 22px;
        cursor: pointer;
        font-weight: bold;
        display: none; /* é»˜è®¤éšè— */
        z-index: 10;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    /* ç¼–è¾‘æ¨¡å¼ä¸‹æ˜¾ç¤ºåˆ é™¤æŒ‰é’® */
    .editing .delete-btn { display: block; }
    .editing .icon-box { animation: shake 0.3s infinite; }
    
    /* æ·»åŠ æŒ‰é’® */
    .add-btn-wrapper {
        display: none; /* é»˜è®¤éšè— */
        width: 100px;
        text-align: center;
    }
    .editing .add-btn-wrapper { display: block; }
    .add-icon-box {
        border: 2px dashed #aaa;
        background: rgba(255,255,255,0.3);
    }

    /* ç®€å•çš„å¼¹çª—æ ·å¼ */
    .modal-overlay {
        display: none;
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }
    .modal-content {
        background: white;
        padding: 20px;
        border-radius: 10px;
        width: 300px;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .modal-content input {
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 5px;
    }
    .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 10px;
    }

    /* --- ä¸‹æ–¹å·¥å…·æ åŸæœ‰æ ·å¼ (ä¿æŒä¸å˜) --- */
    .wrapper {
        width: 60%; /*ç¨å¾®è°ƒå®½ä¸€ç‚¹*/
        text-align: center;
        padding: 20px;
        background-color: rgba(255,255,255,0.6);
        border-radius: 10px;
        backdrop-filter: blur(10px);
        margin-top: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    .search-container { margin-bottom: 20px; }
    .search-box { position: relative; display: flex; justify-content: center; align-items: center; gap: 10px; }
    
    /* è¾“å…¥æ¡†ç»Ÿä¸€æ ·å¼ä¼˜åŒ– */
    input[type="text"] {
        padding: 10px 15px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 16px;
        outline: none;
        transition: border-color 0.3s;
    }
    input[type="text"]:focus { border-color: #007bff; }

    .input-container, .button-container {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 10px;
        flex-wrap: wrap;
    }
    
    button {
        padding: 10px 20px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 15px;
        transition: background-color 0.2s;
    }
    button:hover { background-color: #0056b3; }
    
    .xmd-button { background-color: #06C1AE; }
    .xmd-button:hover { background-color: #036158; }

    @keyframes shake {
        0% { transform: rotate(0deg); }
        25% { transform: rotate(1deg); }
        50% { transform: rotate(0deg); }
        75% { transform: rotate(-1deg); }
        100% { transform: rotate(0deg); }
    }
</style>
</head>
<body>

<div class="shortcut-icons-container" id="navContainer">
    <button id="editToggleBtn" onclick="toggleEditMode()">ç¼–è¾‘å¯¼èˆª</button>
    <div class="shortcut-icons" id="linksArea">
        </div>
</div>

<div class="modal-overlay" id="addModal">
    <div class="modal-content">
        <h3>æ·»åŠ æ–°å¯¼èˆª</h3>
        <input type="text" id="newTitle" placeholder="åç§° (ä¾‹å¦‚: Google)">
        <input type="text" id="newUrl" placeholder="ç½‘å€ (ä¾‹å¦‚: https://...)">
        <input type="text" id="newIcon" placeholder="å›¾æ ‡URL æˆ– Emoji (ä¾‹å¦‚: ğŸ” æˆ– images/xx.svg)">
        <div class="modal-actions">
            <button onclick="closeModal()" style="background:#aaa">å–æ¶ˆ</button>
            <button onclick="saveNewLink()">ä¿å­˜</button>
        </div>
    </div>
</div>

<div class="wrapper" style="background-color: #E6EFFA;">
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="AMPå•†å“æœç´¢..." onkeypress="searchKeyPress(event)" style="width: 50%;">
        <button onclick="search()" style="padding: 10px 15px;">ğŸ”</button>
    </div>

    <div class="input-container" style="margin-top: 15px;">
        <input type="text" id="aidInput" placeholder="AID" style="width: 100px;" oninput="validateAndMoveInput(this, ['pidInput', 'skuIdInput'])">
        <input type="text" id="pidInput" placeholder="PID" style="width: 100px;" oninput="validateAndMoveInput(this, ['skuIdInput'])">
        <input type="text" id="skuIdInput" placeholder="SKU ID" style="width: 100px;" oninput="validateInput(this)">
    </div>

    <div class="button-container">
        <button onclick="gotoAMPPage()">AMPå•†å“é¡µ</button>
        <button onclick="gotoBookingPage()">é¢„å®šé¡µ</button>
        <button onclick="gotoPricePage()">ä»·æ ¼é¡µ</button>
    </div>
</div>

<div class="wrapper" style="background-color: #E0F9F7;">
    <div class="search-box">
        <input type="text" id="xmdInput" placeholder="è¾“å…¥æ–°ç¾å¤§ID (è‡ªåŠ¨æ ¼å¼åŒ–)" style="width: 60%;">    
        <button class="xmd-button" id="copyButton">å¤åˆ¶</button>
    </div>
    <div class="button-container" style="margin-top: 15px;">
        <button class="xmd-button" onclick="gotoSearchPage()">å•†å“æœç´¢é¡µ</button>
        <button class="xmd-button" onclick="gotoGoodsPage()">å•†å“ç¼–è¾‘é¡µ</button>
        <button class="xmd-button" onclick="gotoOrderPage()">è®¢å•é¡µ</button>
    </div>
</div>

<script>
    // ==========================================
    // ç¬¬ä¸€éƒ¨åˆ†ï¼šå¯¼èˆªæ çš„å¯è§†åŒ–ç¼–è¾‘é€»è¾‘ (æ–°å¢)
    // ==========================================

    // é»˜è®¤æ•°æ®ï¼ˆå¦‚æœä½ ç¬¬ä¸€æ¬¡æ‰“å¼€æ˜¯ç©ºçš„ï¼Œä¼šåŠ è½½è¿™äº›ï¼‰
    const defaultLinks = [
        { title: "SlackBot", url: "https://admin.klook.com/agent/api/slackbot", icon: "ğŸ¤–" },
        { title: "æŒ‡ä»¤ç”Ÿæˆ", url: "Generate SlackBot Command.html", icon: "ğŸ”—" },
        { title: "åº“å­˜æŸ¥çœ‹", url: "https://admin.klook.com/storage/realtime/inventory/summary", icon: "ğŸ“¦" },
        { title: "Adminè®¢å•", url: "https://admin.klook.com/order/search", icon: "ğŸ“„" },
        { title: "TTDåˆ—è¡¨", url: "https://admin.klook.com/act/activity/list", icon: "ğŸ¢" },
        { title: "ç¾å›¢å•†å“", url: "https://eo.dianping.com/epassport/goodmanage/spulist", icon: "ğŸ›ï¸" },
        { title: "ç¾å›¢è®¢å•", url: "https://eo.dianping.com/epassport/ordermanage/orderlist", icon: "ğŸ§¾" },
        { title: "ç¾å›¢è¡¨æ ¼", url: "https://docs.google.com/spreadsheets/d/10CTOQDjBWqU8XA2LyJBGP7N9UBPpmHquWEJy6W7KzWM/edit#gid=287743000", icon: "ğŸ“Š" }
    ];

    let links = [];
    let isEditing = false;

    // åˆå§‹åŒ–ï¼šè¯»å– LocalStorage
    function initLinks() {
        const stored = localStorage.getItem('my-nav-links');
        if (stored) {
            links = JSON.parse(stored);
        } else {
            links = defaultLinks;
        }
        renderLinks();
    }

    // æ¸²æŸ“å›¾æ ‡
    function renderLinks() {
        const container = document.getElementById('linksArea');
        container.innerHTML = '';

        links.forEach((link, index) => {
            // åˆ¤æ–­å›¾æ ‡æ˜¯å›¾ç‰‡è·¯å¾„è¿˜æ˜¯emoji
            let iconHtml = '';
            if (link.icon.includes('/') || link.icon.includes('.')) {
                // è®¤ä¸ºæ˜¯å›¾ç‰‡è·¯å¾„
                iconHtml = `<img src="${link.icon}" alt="${link.title}" onerror="this.style.display='none';this.parentNode.innerHTML='ğŸŒ'">`;
            } else {
                // è®¤ä¸ºæ˜¯Emoji
                iconHtml = `<span class="icon-emoji">${link.icon}</span>`;
            }

            const html = `
                <div class="icon-wrapper">
                    <div class="delete-btn" onclick="deleteLink(${index})">Ã—</div>
                    <a href="${link.url}" class="icon-box" target="_self" onclick="return !isEditing">
                        ${iconHtml}
                    </a>
                    <div class="icon-label">${link.title}</div>
                </div>
            `;
            container.innerHTML += html;
        });

        // æ·»åŠ â€œåŠ å·â€æŒ‰é’®
        const addBtnHtml = `
            <div class="add-btn-wrapper icon-wrapper">
                <div class="icon-box add-icon-box" onclick="openModal()">
                    <span class="icon-emoji" style="color:#aaa">â•</span>
                </div>
                <div class="icon-label" style="color:#aaa">æ·»åŠ </div>
            </div>
        `;
        container.innerHTML += addBtnHtml;
    }

    // åˆ‡æ¢ç¼–è¾‘æ¨¡å¼
    function toggleEditMode() {
        isEditing = !isEditing;
        const container = document.getElementById('navContainer');
        const btn = document.getElementById('editToggleBtn');
        
        if (isEditing) {
            container.classList.add('editing');
            btn.innerText = "å®Œæˆä¿å­˜";
            btn.style.background = "#4CAF50";
            btn.style.color = "white";
        } else {
            container.classList.remove('editing');
            btn.innerText = "ç¼–è¾‘å¯¼èˆª";
            btn.style.background = "transparent";
            btn.style.color = "#666";
        }
    }

    // åˆ é™¤
    function deleteLink(index) {
        if(confirm("ç¡®å®šåˆ é™¤è¿™ä¸ªå¿«æ·æ–¹å¼å—ï¼Ÿ")) {
            links.splice(index, 1);
            saveData();
            renderLinks();
        }
    }

    // ä¿å­˜åˆ° LocalStorage
    function saveData() {
        localStorage.setItem('my-nav-links', JSON.stringify(links));
    }

    // --- å¼¹çª—ç›¸å…³ ---
    function openModal() {
        document.getElementById('addModal').style.display = 'flex';
        document.getElementById('newTitle').focus();
    }
    function closeModal() {
        document.getElementById('addModal').style.display = 'none';
        // æ¸…ç©ºè¾“å…¥
        document.getElementById('newTitle').value = '';
        document.getElementById('newUrl').value = '';
        document.getElementById('newIcon').value = '';
    }
    function saveNewLink() {
        const title = document.getElementById('newTitle').value;
        const url = document.getElementById('newUrl').value;
        const icon = document.getElementById('newIcon').value || 'ğŸ”—'; // é»˜è®¤å›¾æ ‡

        if(title && url) {
            links.push({ title, url, icon });
            saveData();
            renderLinks();
            closeModal();
        } else {
            alert("åç§°å’Œç½‘å€å¿…å¡«å“¦");
        }
    }

    // é¡µé¢åŠ è½½æ—¶è¿è¡Œåˆå§‹åŒ–
    initLinks();


    // ==========================================
    // ç¬¬äºŒéƒ¨åˆ†ï¼šä½ åŸæœ‰çš„ä¸šåŠ¡é€»è¾‘è„šæœ¬ (ä¿æŒåŸæ ·)
    // ==========================================
    
    function search() {
        var keyword = document.getElementById("searchInput").value;
        if(keyword) window.location.href = `https://klook.klktech.cn/zh-CN/search?keyword=${encodeURIComponent(keyword)}`;
    }
    
    function searchKeyPress(event) {
        if (event.key === "Enter") search();
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        var xmdInput = document.getElementById("xmdInput");
        if(xmdInput){
            xmdInput.addEventListener('blur', function() { splitXmdId(); });
            xmdInput.addEventListener('keydown', function(event) {
                if (event.key === "Enter" || event.keyCode === 13) {
                    event.preventDefault();
                    splitXmdId();
                }
            });
        }

        var copyButton = document.getElementById("copyButton");
        if(copyButton) {
            copyButton.addEventListener('click', function() {
                var xmdInputText = document.getElementById("xmdInput").value;
                navigator.clipboard.writeText(xmdInputText).then(function() {
                    showAlert("å¤åˆ¶æˆåŠŸ")
                }).catch(function(error) {
                    showAlert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶")
                });
            });
        }
    });

    function validateAndMoveInput(input, nextInputIds) {
        let parts = input.value.split(/[^0-9]+/);
        input.value = parts[0];
        parts.slice(1).forEach((part, index) => {
            if (index < nextInputIds.length) {
                let nextInput = document.getElementById(nextInputIds[index]);
                nextInput.value = part;
            }
        });
        input.addEventListener('keydown', function(e) {
            if (e.key === "Enter") {
                e.preventDefault();
                // ç®€å•æŸ¥æ‰¾ä¸‹ä¸€ä¸ªæŒ‰é’®
                let btns = document.querySelectorAll('.button-container button');
                if(btns.length > 0) btns[0].focus();
            }
        });
    }

    function validateInput(input) {
        input.value = input.value.replace(/\D/g, '');
        input.addEventListener('keydown', function(e) {
            if (e.key === "Enter") {
                e.preventDefault();
                let btns = document.querySelectorAll('.button-container button');
                if(btns.length > 0) btns[0].focus();
            }
        });
    }
    
    // æŒ‰é’®æ–¹å‘é”®é€»è¾‘
    document.querySelectorAll('.button-container button').forEach((button, index, buttons) => {
        button.addEventListener('keydown', function(e) {
            if (e.key === "ArrowRight") {
                e.preventDefault();
                buttons[(index + 1) % buttons.length].focus();
            } else if (e.key === "ArrowLeft") {
                e.preventDefault();
                buttons[(index - 1 + buttons.length) % buttons.length].focus();
            } else if (e.key === "Enter") {
                e.preventDefault();
                button.click();
            }
        });
    });
    
    function gotoAMPPage() {
        var aid = document.getElementById("aidInput").value;
        if (aid) {
            window.location.href = `https://klook.klktech.cn/zh-CN/activity/${aid}`;
        } else {
            alert("è¯·è¾“å…¥AID");
        }
    }
    
    function gotoBookingPage() {
        var pid = document.getElementById("pidInput").value;
        var skuId = document.getElementById("skuIdInput").value;
        if (pid && skuId) {
            window.location.href = `https://klook.klktech.cn/zh-CN/pay_ticket/${pid}/${skuId}`;
        } else {
            alert("è¯·è¾“å…¥PIDå’ŒSKU ID");
        }
    }
    
    function gotoPricePage() {
        var aid = document.getElementById("aidInput").value;
        var pid = document.getElementById("pidInput").value;
        if (aid && !pid) {
            window.location.href = `https://admin.klook.com/act/activity/basic/${aid}?edit_status=1&is_am=true&ref=&lang=zh_CN`;
        } else if (aid && pid) {
            window.location.href = `https://admin.klook.com/mspa/experiencesadmincommon/act/package/schedule/${aid}?iframe=true&edit_status=1&ref=&lang=zh_CN&page_from=admin&package_type=-1&package_id=${pid}`;
        } else {
            alert("è¯·è‡³å°‘è¾“å…¥AID");
        }
    }

    function splitXmdId() {
        var xmdInput = document.getElementById("xmdInput").value.trim();
        var formatted = xmdInput.replace(/[^0-9]+/g, ',').replace(/,+/g, ',').trim(',');
        document.getElementById("xmdInput").value = formatted;
    }

    function gotoSearchPage() {
        var xmdId = document.getElementById("xmdInput").value;
        if (!/^\d+(,\d+)*$/.test(xmdId)) {
            showAlert("è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥");
        } else {
            var idsArray = xmdId.split(',').map(id => '"' + id + '"');
            var url = `https://eo.dianping.com/epassport/goodmanage/spulist?tab=book&spuIds=[${idsArray.join(',')}]`;
            window.location.href = url;
        }
    }

    function gotoGoodsPage() {
        var xmdId = document.getElementById("xmdInput").value.trim();
        if (!xmdId || !/^\d+(,\d+)*$/.test(xmdId)) {
            showAlert("è¾“å…¥æ¡†ç©ºç™½ï¼Œè·³è½¬åˆ°Listé¡µ");
            window.location.href = "https://eo.dianping.com/epassport/goodmanage/spulist";
        } else {
            var ids = xmdId.split(',');
            if (ids.length > 0) {
                window.location.href = `https://eo.dianping.com/epassport/goodmanage/spudetail?categoryid=1008&spuid=${ids[0]}`;
                for (var i = 1; i < ids.length; i++) {
                    window.open(`https://eo.dianping.com/epassport/goodmanage/spudetail?categoryid=1008&spuid=${ids[i]}`, '_blank');
                }
            }
        }
    }

    function gotoOrderPage() {
        var xmdId = document.getElementById("xmdInput").value;
        if (!xmdId || /\D/.test(xmdId)) {
            showAlert("å†…å®¹éæ³•ï¼Œè·³è½¬åˆ°Listé¡µ");
            window.location.href = "https://eo.dianping.com/epassport/ordermanage/orderlist";
        } else {
            window.location.href = `https://eo.dianping.com/epassport/ordermanage/orderdetail?orderid=${xmdId}`;
        }
    }

    function showAlert(message) {
        var alertBox = document.createElement("div");
        alertBox.innerText = message;
        alertBox.style.cssText = "position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.7);color:white;padding:20px;border-radius:10px;z-index:1000;";
        document.body.appendChild(alertBox);
        setTimeout(function() {
            if(alertBox.parentNode) document.body.removeChild(alertBox);
        }, 3000);
    }
</script>

</body>
</html>
